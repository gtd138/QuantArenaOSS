<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>å‰ç«¯æ•°æ®æ£€æŸ¥</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        pre { background: #f5f5f5; padding: 10px; white-space: pre-wrap; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>å‰ç«¯æ•°æ®æ£€æŸ¥</h1>
    <button onclick="checkData()">æ£€æŸ¥æ•°æ®</button>
    <div id="result"></div>

    <script>
        const API_BASE = 'http://localhost:8000';
        
        async function checkData() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/api/arena/data`);
                const data = await response.json();
                
                let html = '<h2 class="success">âœ… APIå“åº”æˆåŠŸ</h2>';
                html += `<p>æ¨¡å‹æ•°é‡: ${Object.keys(data).length}</p>`;
                
                // æ£€æŸ¥æ¯ä¸ªæ¨¡å‹
                for (const [modelName, modelData] of Object.entries(data)) {
                    html += `<h3>ğŸ“Š ${modelName}</h3>`;
                    html += `<ul>`;
                    html += `<li>daily_assets: ${modelData.daily_assets?.length || 0} æ¡</li>`;
                    html += `<li>trade_history: ${modelData.trade_history?.length || 0} æ¡</li>`;
                    html += `<li>holdings: ${modelData.holdings?.length || 0} æ¡</li>`;
                    html += `</ul>`;
                    
                    // æ£€æŸ¥trade_historyå­—æ®µ
                    if (modelData.trade_history && modelData.trade_history.length > 0) {
                        const firstTrade = modelData.trade_history[0];
                        html += `<p><strong>ç¬¬ä¸€æ¡äº¤æ˜“çš„å­—æ®µï¼š</strong></p>`;
                        html += `<pre>${JSON.stringify(firstTrade, null, 2)}</pre>`;
                        
                        // æ£€æŸ¥å…³é”®å­—æ®µ
                        const hasDate = 'date' in firstTrade;
                        const hasAction = 'action' in firstTrade;
                        const hasStockCode = 'stock_code' in firstTrade;
                        
                        if (hasDate && hasAction && hasStockCode) {
                            html += `<p class="success">âœ… äº¤æ˜“è®°å½•å­—æ®µå®Œæ•´ï¼</p>`;
                        } else {
                            html += `<p class="error">âŒ äº¤æ˜“è®°å½•å­—æ®µç¼ºå¤±ï¼š</p>`;
                            html += `<ul>`;
                            if (!hasDate) html += `<li class="error">ç¼ºå°‘ date å­—æ®µ</li>`;
                            if (!hasAction) html += `<li class="error">ç¼ºå°‘ action å­—æ®µ</li>`;
                            if (!hasStockCode) html += `<li class="error">ç¼ºå°‘ stock_code å­—æ®µ</li>`;
                            html += `</ul>`;
                        }
                        
                        // æµ‹è¯•æ’åº
                        try {
                            const trades = modelData.trade_history.slice();
                            trades.sort((a, b) => b.date.localeCompare(a.date));
                            html += `<p class="success">âœ… äº¤æ˜“è®°å½•å¯ä»¥æ’åºï¼</p>`;
                            html += `<p>æœ€æ–°äº¤æ˜“æ—¥æœŸ: ${trades[0].date}</p>`;
                        } catch (e) {
                            html += `<p class="error">âŒ æ’åºå¤±è´¥: ${e.message}</p>`;
                        }
                        
                        break; // åªæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¨¡å‹
                    }
                }
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<p class="error">âŒ é”™è¯¯: ${error.message}</p>`;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = checkData;
    </script>
</body>
</html>
